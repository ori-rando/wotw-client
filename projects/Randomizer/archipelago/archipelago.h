#pragma once

#include <IXWebSocket.h>
#include <nlohmann/json.hpp>
#include <string>
#include <unordered_set>
#include "Core/api/uber_states/uber_state.h"

#include "Randomizer/archipelago/archipelago_ids.h"
#include "archipelago_protocol.h"

namespace randomizer::archipelago {
    class ArchipelagoClient {
    public:
        ArchipelagoClient();
        void connect(std::string_view url, std::string_view slot_name, std::string_view password);
        void disconnect();
        bool is_connected() const;

    private:
        template<typename Jsonable>
        void send_message(const Jsonable& message) {
            const nlohmann::json json(message);
            m_websocket.send(json.dump());
        }

        void give_item(archipelago::messages::NetworkItem const& net_item);
        void on_websocket_message(ix::WebSocketMessagePtr const& msg);
        void handle_server_message(messages::ap_server_message_t const& message);

        bool m_connected = false;
        bool m_should_connect = false;
        ix::WebSocket m_websocket;
        std::string m_slot_name;  // aka player name
        std::string m_password;
        int m_last_item_index = 0;
        std::vector<ids::archipelago_id_t> m_cached_locations;
        std::vector<archipelago::messages::NetworkPlayer> m_players;
    };

    std::unordered_set<core::api::uber_states::UberState> locations_map = {
        core::api::uber_states::UberState(21786, 60210),
        core::api::uber_states::UberState(21786, 49485),
        core::api::uber_states::UberState(21786, 25761),
        core::api::uber_states::UberState(21786, 6987),
        core::api::uber_states::UberState(23987, 59173),
        core::api::uber_states::UberState(21786, 29892),
        core::api::uber_states::UberState(21786, 7152),
        core::api::uber_states::UberState(9593, 5929),
        core::api::uber_states::UberState(48248, 18767),
        core::api::uber_states::UberState(0, 77),
        core::api::uber_states::UberState(21786, 17920),
        core::api::uber_states::UberState(21786, 59513),
        core::api::uber_states::UberState(9593, 42047),
        core::api::uber_states::UberState(21786, 64677),
        core::api::uber_states::UberState(48248, 51645),
        core::api::uber_states::UberState(9593, 23858),
        core::api::uber_states::UberState(21786, 23154),
        core::api::uber_states::UberState(9593, 20382),
        core::api::uber_states::UberState(23987, 50415),
        core::api::uber_states::UberState(24922, 32076),
        core::api::uber_states::UberState(24922, 62138),
        core::api::uber_states::UberState(48248, 18458),
        core::api::uber_states::UberState(23987, 9864),
        core::api::uber_states::UberState(21786, 43668),
        core::api::uber_states::UberState(21786, 61706),
        core::api::uber_states::UberState(14019, 27539),
        core::api::uber_states::UberState(14019, 15983),
        core::api::uber_states::UberState(0, 121),
        core::api::uber_states::UberState(21786, 21727),
        core::api::uber_states::UberState(24922, 60358),
        core::api::uber_states::UberState(24922, 47244),
        core::api::uber_states::UberState(24922, 34250),
        core::api::uber_states::UberState(24922, 33535),
        core::api::uber_states::UberState(48248, 45538),
        core::api::uber_states::UberState(24922, 46311),
        core::api::uber_states::UberState(14019, 52747),
        core::api::uber_states::UberState(21786, 28908),
        core::api::uber_states::UberState(9593, 61304),
        core::api::uber_states::UberState(21786, 22068),
        core::api::uber_states::UberState(21786, 63545),
        core::api::uber_states::UberState(0, 100),
        core::api::uber_states::UberState(21786, 2046),
        core::api::uber_states::UberState(21786, 16206),
        core::api::uber_states::UberState(21786, 2852),
        core::api::uber_states::UberState(24922, 13993),
        core::api::uber_states::UberState(9593, 17818),
        core::api::uber_states::UberState(23987, 27134),
        core::api::uber_states::UberState(0, 5),
        core::api::uber_states::UberState(9593, 5253),
        core::api::uber_states::UberState(9593, 25989),
        core::api::uber_states::UberState(9593, 27562),
        core::api::uber_states::UberState(21786, 20194),
        core::api::uber_states::UberState(21786, 10413),
        core::api::uber_states::UberState(44964, 45951),
        core::api::uber_states::UberState(21786, 18109),
        core::api::uber_states::UberState(9593, 59344),
        core::api::uber_states::UberState(21786, 27433),
        core::api::uber_states::UberState(21786, 37225),
        core::api::uber_states::UberState(21786, 10295),
        core::api::uber_states::UberState(0, 97),
        core::api::uber_states::UberState(21786, 50255),
        core::api::uber_states::UberState(9593, 26457),
        core::api::uber_states::UberState(945, 10833),
        core::api::uber_states::UberState(937, 61897),
        core::api::uber_states::UberState(937, 16163),
        core::api::uber_states::UberState(937, 2538),
        core::api::uber_states::UberState(937, 8518),
        core::api::uber_states::UberState(23987, 61017),
        core::api::uber_states::UberState(937, 24175),
        core::api::uber_states::UberState(48248, 3638),
        core::api::uber_states::UberState(937, 2463),
        core::api::uber_states::UberState(44964, 25545),
        core::api::uber_states::UberState(937, 48192),
        core::api::uber_states::UberState(937, 61744),
        core::api::uber_states::UberState(937, 37926),
        core::api::uber_states::UberState(937, 50176),
        core::api::uber_states::UberState(0, 102),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(937, 10729),
        core::api::uber_states::UberState(937, 13413),
        core::api::uber_states::UberState(937, 5568),
        core::api::uber_states::UberState(937, 45987),
        core::api::uber_states::UberState(937, 19529),
        core::api::uber_states::UberState(937, 23772),
        core::api::uber_states::UberState(13428, 59730),
        core::api::uber_states::UberState(937, 30182),
        core::api::uber_states::UberState(0, 0),
        core::api::uber_states::UberState(14019, 50597),
        core::api::uber_states::UberState(58674, 20983),
        core::api::uber_states::UberState(58674, 9583),
        core::api::uber_states::UberState(23987, 62973),
        core::api::uber_states::UberState(46462, 59806),
        core::api::uber_states::UberState(46462, 37897),
        core::api::uber_states::UberState(46462, 29054),
        core::api::uber_states::UberState(46462, 20780),
        core::api::uber_states::UberState(18793, 42980),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(14019, 27804),
        core::api::uber_states::UberState(14019, 2782),
        core::api::uber_states::UberState(14019, 33776),
        core::api::uber_states::UberState(42178, 52786),
        core::api::uber_states::UberState(44310, 29043),
        core::api::uber_states::UberState(44310, 17523),
        core::api::uber_states::UberState(42178, 27110),
        core::api::uber_states::UberState(42178, 23125),
        core::api::uber_states::UberState(23987, 23015),
        core::api::uber_states::UberState(23987, 14014),
        core::api::uber_states::UberState(42178, 51468),
        core::api::uber_states::UberState(42178, 13327),
        core::api::uber_states::UberState(42178, 57455),
        core::api::uber_states::UberState(42178, 30520),
        core::api::uber_states::UberState(42178, 59623),
        core::api::uber_states::UberState(42178, 9780),
        core::api::uber_states::UberState(42178, 18448),
        core::api::uber_states::UberState(42178, 6117),
        core::api::uber_states::UberState(42178, 51934),
        core::api::uber_states::UberState(42178, 42762),
        core::api::uber_states::UberState(42178, 30206),
        core::api::uber_states::UberState(42178, 37028),
        core::api::uber_states::UberState(42178, 63404),
        core::api::uber_states::UberState(42178, 44748),
        core::api::uber_states::UberState(0, 120),
        core::api::uber_states::UberState(14019, 44578),
        core::api::uber_states::UberState(23987, 14832),
        core::api::uber_states::UberState(14019, 26394),
        core::api::uber_states::UberState(53632, 12019),
        core::api::uber_states::UberState(937, 31036),
        core::api::uber_states::UberState(937, 40657),
        core::api::uber_states::UberState(937, 45744),
        core::api::uber_states::UberState(937, 17761),
        core::api::uber_states::UberState(937, 6703),
        core::api::uber_states::UberState(937, 11846),
        core::api::uber_states::UberState(44310, 36911),
        core::api::uber_states::UberState(44310, 9902),
        core::api::uber_states::UberState(53632, 25556),
        core::api::uber_states::UberState(53632, 1911),
        core::api::uber_states::UberState(53632, 51706),
        core::api::uber_states::UberState(37858, 58286),
        core::api::uber_states::UberState(44964, 11512),
        core::api::uber_states::UberState(23987, 12104),
        core::api::uber_states::UberState(53632, 17403),
        core::api::uber_states::UberState(53632, 42264),
        core::api::uber_states::UberState(53632, 6500),
        core::api::uber_states::UberState(53632, 6869),
        core::api::uber_states::UberState(23987, 53934),
        core::api::uber_states::UberState(53632, 62356),
        core::api::uber_states::UberState(53632, 21124),
        core::api::uber_states::UberState(14019, 20667),
        core::api::uber_states::UberState(23987, 31426),
        core::api::uber_states::UberState(37858, 22107),
        core::api::uber_states::UberState(37858, 45906),
        core::api::uber_states::UberState(37858, 45656),
        core::api::uber_states::UberState(37858, 25833),
        core::api::uber_states::UberState(37858, 41380),
        core::api::uber_states::UberState(37858, 58846),
        core::api::uber_states::UberState(37858, 57552),
        core::api::uber_states::UberState(37858, 41911),
        core::api::uber_states::UberState(48248, 1590),
        core::api::uber_states::UberState(37858, 33063),
        core::api::uber_states::UberState(37858, 31136),
        core::api::uber_states::UberState(0, 57),
        core::api::uber_states::UberState(37858, 64086),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(37858, 52110),
        core::api::uber_states::UberState(37858, 47533),
        core::api::uber_states::UberState(53632, 41227),
        core::api::uber_states::UberState(37858, 59022),
        core::api::uber_states::UberState(37858, 2797),
        core::api::uber_states::UberState(14019, 24142),
        core::api::uber_states::UberState(37858, 32932),
        core::api::uber_states::UberState(37858, 56444),
        core::api::uber_states::UberState(37858, 12379),
        core::api::uber_states::UberState(945, 10682),
        core::api::uber_states::UberState(945, 14530),
        core::api::uber_states::UberState(945, 37243),
        core::api::uber_states::UberState(945, 21334),
        core::api::uber_states::UberState(945, 58723),
        core::api::uber_states::UberState(5377, 34852),
        core::api::uber_states::UberState(14019, 53103),
        core::api::uber_states::UberState(5377, 13832),
        core::api::uber_states::UberState(5377, 17396),
        core::api::uber_states::UberState(5377, 27204),
        core::api::uber_states::UberState(5377, 19694),
        core::api::uber_states::UberState(5377, 63201),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(5377, 7540),
        core::api::uber_states::UberState(5377, 12235),
        core::api::uber_states::UberState(23987, 25996),
        core::api::uber_states::UberState(5377, 45774),
        core::api::uber_states::UberState(44964, 54686),
        core::api::uber_states::UberState(5377, 40328),
        core::api::uber_states::UberState(5377, 35440),
        core::api::uber_states::UberState(48248, 1557),
        core::api::uber_states::UberState(5377, 18345),
        core::api::uber_states::UberState(14019, 28662),
        core::api::uber_states::UberState(5377, 46926),
        core::api::uber_states::UberState(5377, 35091),
        core::api::uber_states::UberState(5377, 16426),
        core::api::uber_states::UberState(5377, 41881),
        core::api::uber_states::UberState(5377, 33110),
        core::api::uber_states::UberState(5377, 31434),
        core::api::uber_states::UberState(5377, 1600),
        core::api::uber_states::UberState(5377, 628),
        core::api::uber_states::UberState(5377, 21860),
        core::api::uber_states::UberState(0, 104),
        core::api::uber_states::UberState(5377, 52791),
        core::api::uber_states::UberState(5377, 33180),
        core::api::uber_states::UberState(5377, 32750),
        core::api::uber_states::UberState(5377, 62180),
        core::api::uber_states::UberState(5377, 65019),
        core::api::uber_states::UberState(5377, 25391),
        core::api::uber_states::UberState(5377, 44122),
        core::api::uber_states::UberState(945, 49747),
        core::api::uber_states::UberState(14019, 59708),
        core::api::uber_states::UberState(14019, 57399),
        core::api::uber_states::UberState(14019, 7470),
        core::api::uber_states::UberState(58674, 8487),
        core::api::uber_states::UberState(58674, 28710),
        core::api::uber_states::UberState(58674, 22472),
        core::api::uber_states::UberState(58674, 59691),
        core::api::uber_states::UberState(58674, 40073),
        core::api::uber_states::UberState(58674, 11736),
        core::api::uber_states::UberState(58674, 43033),
        core::api::uber_states::UberState(58674, 19769),
        core::api::uber_states::UberState(58674, 42531),
        core::api::uber_states::UberState(58674, 780),
        core::api::uber_states::UberState(58674, 26274),
        core::api::uber_states::UberState(58674, 42158),
        core::api::uber_states::UberState(58674, 33893),
        core::api::uber_states::UberState(58674, 30908),
        core::api::uber_states::UberState(58674, 59714),
        core::api::uber_states::UberState(58674, 20713),
        core::api::uber_states::UberState(58674, 54516),
        core::api::uber_states::UberState(58674, 23186),
        core::api::uber_states::UberState(58674, 64057),
        core::api::uber_states::UberState(58674, 17974),
        core::api::uber_states::UberState(44964, 22703),
        core::api::uber_states::UberState(23987, 25183),
        core::api::uber_states::UberState(58674, 29265),
        core::api::uber_states::UberState(58674, 32647),
        core::api::uber_states::UberState(58674, 64484),
        core::api::uber_states::UberState(28895, 55384),
        core::api::uber_states::UberState(28895, 24533),
        core::api::uber_states::UberState(28895, 3777),
        core::api::uber_states::UberState(28895, 58675),
        core::api::uber_states::UberState(28895, 45337),
        core::api::uber_states::UberState(28895, 38143),
        core::api::uber_states::UberState(28895, 47529),
        core::api::uber_states::UberState(48248, 29604),
        core::api::uber_states::UberState(28895, 4301),
        core::api::uber_states::UberState(28895, 45066),
        core::api::uber_states::UberState(28895, 36231),
        core::api::uber_states::UberState(28895, 38049),
        core::api::uber_states::UberState(42178, 40609),
        core::api::uber_states::UberState(28895, 35045),
        core::api::uber_states::UberState(28895, 54373),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(28895, 40744),
        core::api::uber_states::UberState(28895, 53283),
        core::api::uber_states::UberState(28895, 46711),
        core::api::uber_states::UberState(23987, 36359),
        core::api::uber_states::UberState(28895, 46404),
        core::api::uber_states::UberState(28895, 25522),
        core::api::uber_states::UberState(28895, 29898),
        core::api::uber_states::UberState(28895, 10823),
        core::api::uber_states::UberState(28895, 37444),
        core::api::uber_states::UberState(28895, 18358),
        core::api::uber_states::UberState(28895, 22761),
        core::api::uber_states::UberState(44964, 23661),
        core::api::uber_states::UberState(23987, 897),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(23987, 19630),
        core::api::uber_states::UberState(28287, 32414),
        core::api::uber_states::UberState(28895, 1053),
        core::api::uber_states::UberState(28895, 50368),
        core::api::uber_states::UberState(28895, 22382),
        core::api::uber_states::UberState(28895, 9949),
        core::api::uber_states::UberState(28895, 23795),
        core::api::uber_states::UberState(28895, 40089),
        core::api::uber_states::UberState(28895, 40242),
        core::api::uber_states::UberState(0, 51),
        core::api::uber_states::UberState(28895, 39291),
        core::api::uber_states::UberState(28895, 7597),
        core::api::uber_states::UberState(14019, 32376),
        core::api::uber_states::UberState(28895, 2129),
        core::api::uber_states::UberState(18793, 19004),
        core::api::uber_states::UberState(18793, 15396),
        core::api::uber_states::UberState(18793, 35351),
        core::api::uber_states::UberState(18793, 1914),
        core::api::uber_states::UberState(18793, 58148),
        core::api::uber_states::UberState(18793, 26618),
        core::api::uber_states::UberState(18793, 29979),
        core::api::uber_states::UberState(18793, 53953),
        core::api::uber_states::UberState(18793, 23986),
        core::api::uber_states::UberState(14019, 8192),
        core::api::uber_states::UberState(18793, 18395),
        core::api::uber_states::UberState(18793, 42235),
        core::api::uber_states::UberState(18793, 6573),
        core::api::uber_states::UberState(18793, 63291),
        core::api::uber_states::UberState(18793, 62694),
        core::api::uber_states::UberState(44964, 28552),
        core::api::uber_states::UberState(18793, 836),
        core::api::uber_states::UberState(23987, 986),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(18793, 31937),
        core::api::uber_states::UberState(18793, 28175),
        core::api::uber_states::UberState(48248, 48423),
        core::api::uber_states::UberState(18793, 2881),
        core::api::uber_states::UberState(18793, 23799),
        core::api::uber_states::UberState(0, 62),
        core::api::uber_states::UberState(7228, 54494),
        core::api::uber_states::UberState(7228, 56821),
        core::api::uber_states::UberState(7228, 52086),
        core::api::uber_states::UberState(44964, 30767),
        core::api::uber_states::UberState(20120, 46919),
        core::api::uber_states::UberState(14019, 58342),
        core::api::uber_states::UberState(20120, 11785),
        core::api::uber_states::UberState(20120, 62264),
        core::api::uber_states::UberState(20120, 57781),
        core::api::uber_states::UberState(20120, 10397),
        core::api::uber_states::UberState(20120, 224),
        core::api::uber_states::UberState(20120, 12941),
        core::api::uber_states::UberState(23987, 50364),
        core::api::uber_states::UberState(20120, 33275),
        core::api::uber_states::UberState(20120, 57133),
        core::api::uber_states::UberState(20120, 8910),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(48248, 61146),
        core::api::uber_states::UberState(0, 101),
        core::api::uber_states::UberState(20120, 19113),
        core::api::uber_states::UberState(20120, 50026),
        core::api::uber_states::UberState(20120, 48829),
        core::api::uber_states::UberState(20120, 17798),
        core::api::uber_states::UberState(20120, 59046),
        core::api::uber_states::UberState(20120, 40245),
        core::api::uber_states::UberState(7228, 20282),
        core::api::uber_states::UberState(7228, 62117),
        core::api::uber_states::UberState(23987, 48605),
        core::api::uber_states::UberState(7228, 35329),
        core::api::uber_states::UberState(20120, 22354),
        core::api::uber_states::UberState(20120, 30740),
        core::api::uber_states::UberState(20120, 52812),
        core::api::uber_states::UberState(20120, 18965),
        core::api::uber_states::UberState(20120, 2013),
        core::api::uber_states::UberState(7228, 54275),
        core::api::uber_states::UberState(7228, 48993),
        core::api::uber_states::UberState(7228, 61548),
        core::api::uber_states::UberState(14019, 20601),
        core::api::uber_states::UberState(7228, 8370),
        core::api::uber_states::UberState(10289, 44555),
        core::api::uber_states::UberState(10289, 22102),
        core::api::uber_states::UberState(14019, 26318),
        core::api::uber_states::UberState(36153, 3013),
        core::api::uber_states::UberState(0, 8),
        core::api::uber_states::UberState(36153, 36521),
        core::api::uber_states::UberState(36153, 12077),
        core::api::uber_states::UberState(16155, 38979),
        core::api::uber_states::UberState(16155, 49381),
        core::api::uber_states::UberState(16155, 46270),
        core::api::uber_states::UberState(48248, 4045),
        core::api::uber_states::UberState(16155, 9230),
        core::api::uber_states::UberState(16155, 55446),
        core::api::uber_states::UberState(36153, 23902),
        core::api::uber_states::UberState(36153, 3662),
        core::api::uber_states::UberState(2, 1),
        core::api::uber_states::UberState(2, 2),
        core::api::uber_states::UberState(2, 3),
        core::api::uber_states::UberState(2, 5),
        core::api::uber_states::UberState(2, 19),
        core::api::uber_states::UberState(2, 22),
        core::api::uber_states::UberState(2, 26),
        core::api::uber_states::UberState(2, 40),
        core::api::uber_states::UberState(1, 23),
        core::api::uber_states::UberState(1, 74),
        core::api::uber_states::UberState(1, 98),
        core::api::uber_states::UberState(1, 105),
        core::api::uber_states::UberState(1, 106),
        core::api::uber_states::UberState(1, 115),
        core::api::uber_states::UberState(1, 116),
        core::api::uber_states::UberState(1, 1074),
        core::api::uber_states::UberState(1, 1098),
        core::api::uber_states::UberState(1, 1106),
        core::api::uber_states::UberState(1, 1115),
        core::api::uber_states::UberState(1, 1116),
        core::api::uber_states::UberState(15, 19396),
        core::api::uber_states::UberState(15, 57987),
        core::api::uber_states::UberState(15, 41666)        
    };
} // namespace randomizer::archipelago
